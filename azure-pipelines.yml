# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml
name: $(SourceBranchName)_$(Build_Pipeline)_$(date:yyyyMMdd)$(rev:.r)

trigger:
- master

pool:
  name: EDIP_Agents

steps:

- script: |
    echo ""
    echo "System.TeamProject: $(System.TeamProject)"
    echo "Build.Repository.Name: $(Build.Repository.Name)"
    echo "Build.BuildId: $(Build.BuildId)"
    echo "Build.BuildNumber: $(Build.BuildNumber)"
    echo ""
    echo "Agent.BuildDirectory: $(Agent.BuildDirectory)"
    echo "Build.ArtifactStagingDirectory: $(Build.ArtifactStagingDirectory)"
    echo "Build.BinariesDirectory: $(Build.BinariesDirectory)"
    echo "Build.SourcesDirectory: $(Build.SourcesDirectory)"
    echo ""
    echo "Initial Structure of BuildDirectory folder of this pipeline:"
    find $(Agent.BuildDirectory) -print | sed -e "s;[^/]*/;|____;g;s;____|; |;g"
  displayName: 'Check Initial Structure of BuildDirectory folder'


- task: CopyFiles@2
  displayName: "Copy Code Files"
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)'
    Contents: |
      src/**
      dags/**
      drivers/**
      config/**
    TargetFolder: '$(Build.ArtifactStagingDirectory)/s'
    CleanTargetFolder: true
    OverWrite: true



- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(build.artifactstagingdirectory)/s/src
    artifactName: SRC
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(build.artifactstagingdirectory)/s/dags
    artifactName: DAGS
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(build.artifactstagingdirectory)/s/drivers
    artifactName: DRIVERS
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: $(build.artifactstagingdirectory)/s/config
    artifactName: CONFIG



- script: |
    echo ""
    echo "Final Structure of BuildDirectory folder of this pipeline:"
    find $(Agent.BuildDirectory) -print | sed -e "s;[^/]*/;|____;g;s;____|; |;g"
  displayName: 'Check Final Structure of BuildDirectory folder'
