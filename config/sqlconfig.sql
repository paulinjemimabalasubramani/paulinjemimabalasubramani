
USE EDIPIngestion
GO




CREATE TABLE metadata.DataSource
(
DataSourceId int Identity,
DataSourceKey varchar(1000),
Category varchar(100),
SubCategory varchar(100),
Firm varchar(100),
DataSourceType varchar(100),
DataProvider varchar(1000),
UpdatedBy varchar(1000),
UpdateTS datetime,
DataSourceUniqueKey varchar(1000)
);



INSERT INTO metadata.DataSource
(DataSourceKey, Category, SubCategory, Firm, DataSourceType, DataProvider, UpdatedBy, UpdateTS)
VALUES
('METRICS_AG_DATASOURCE_ASSETS_RAA', 'Metrics', 'Assets', 'RAA', 'csv_with_date', 'AG', 'System', CURRENT_TIMESTAMP),
('METRICS_AG_DATASOURCE_ASSETS_WFS', 'Metrics', 'Assets', 'WFS', 'csv_with_date', 'AG', 'System', CURRENT_TIMESTAMP),
('METRICS_AG_DATASOURCE_ASSETS_SPF', 'Metrics', 'Assets', 'SPF', 'csv_with_date', 'AG', 'System', CURRENT_TIMESTAMP),

('ASSETS_AG_DATASOURCE_FRONTPOINT', 'Assets', 'Frontpoint', '', 'assets_frontpoint', 'AG', 'System', CURRENT_TIMESTAMP),

('ASSETS_AG_DATASOURCE_PRODUCT', 'Assets', 'Product', '', 'csv', 'AG', 'System', CURRENT_TIMESTAMP),

('CA_AG_DATASOURCE_PERSHING_RAA', 'Client Account', 'Pershing Customer Account', 'RAA', 'pershing', 'AG', 'System', CURRENT_TIMESTAMP),

('ASSETS_AG_DATASOURCE_PERSHING_RAA', 'Assets', 'Pershing Assets', 'RAA', 'pershing', 'AG', 'System', CURRENT_TIMESTAMP),

('ASSETS_AG_DATASOURCE_ALBRIDGE_WFS', 'Assets', 'Albridge', 'WFS', 'assets_albridge', 'AG', 'System', CURRENT_TIMESTAMP),

('CA_AG_DATASOURCE_NBS', 'Client Account', 'NBS', '', 'csv', 'AG', 'System', CURRENT_TIMESTAMP),
('CA_AG_DATASOURCE_CLIENTODS', 'Client Account', 'ClientODS', '', 'csv', 'AG', 'System', CURRENT_TIMESTAMP),

('CA_AG_DATASOURCE_NFS_RAA', 'Client Account', 'NFS', '', 'nfs', 'AG', 'System', CURRENT_TIMESTAMP),

('ASSETS_AG_DATASOURCE_ALBRIDGE_COPY', 'Assets', 'Albridge', '', 'assets_copy_albridge', 'AG', 'System', CURRENT_TIMESTAMP),

('ASSETS_AG_DATASOURCE_NFS_SPF', 'Assets', 'NFS', 'SPF', 'nfs', 'AG', 'System', CURRENT_TIMESTAMP),

('AG_DATASOURCE_NFS_COPY', '', 'NFS', '', 'copy_nfs', 'AG', 'System', CURRENT_TIMESTAMP)


;





SELECT * FROM metadata.DataSource
where DataSourceKey = 'ASSETS_AG_DATASOURCE_ALBRIDGE_COPY'
ORDER BY DataSourceId DESC;






CREATE TABLE metadata.Pipeline
(
PipelineId int Identity,
PipelineKey varchar(1000),
PipelineCategory varchar(1000),
PipelineDescription varchar(1000),
DataSourceKey varchar(1000),
PreRunCode varchar(1000),
Schedule varchar(1000),
IsActive varchar(10),
UpdatedBy varchar(1000),
UpdateTS datetime
);




INSERT INTO metadata.Pipeline
(PipelineKey, PipelineCategory, PipelineDescription, DataSourceKey, PreRunCode, Schedule, IsActive, UpdatedBy, UpdateTS)
VALUES
('METRICS_MIGRATE_ASSETS_RAA', 'outbound_migration', 'Pipeline to migrate Assets to Snowflake for RAA', 'METRICS_AG_DATASOURCE_ASSETS_RAA', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'outbound_migration', 'Pipeline to migrate Assets to Snowflake for RAA', 'METRICS_AG_DATASOURCE_ASSETS_WFS', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'outbound_migration', 'Pipeline to migrate Assets to Snowflake for RAA', 'METRICS_AG_DATASOURCE_ASSETS_SPF', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('ASSETS_MIGRATE_FRONTPOINT', 'outbound_migration', 'Pipeline to migrate Assets-Frontpoint SAI and LTS files to Snowflake', 'ASSETS_AG_DATASOURCE_FRONTPOINT', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('ASSETS_MIGRATE_PRODUCT', 'outbound_migration', 'Pipeline to migrate Assets-Product files to Snowflake', 'ASSETS_AG_DATASOURCE_PRODUCT', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('CA_MIGRATE_PERSHING_RAA', 'outbound_migration', 'Pipeline to migrate CA-Pershing files to Snowflake for RAA', 'CA_AG_DATASOURCE_PERSHING_RAA', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('ASSETS_MIGRATE_PERSHING_RAA', 'outbound_migration', 'Pipeline to migrate ASSETS-Pershing files to Snowflake for RAA', 'ASSETS_AG_DATASOURCE_PERSHING_RAA', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('ASSETS_MIGRATE_ALBRIDGE_WFS', 'outbound_migration', 'Pipeline to migrate Assets-Albridge files to Snowflake for WFS', 'ASSETS_AG_DATASOURCE_ALBRIDGE_WFS', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('CA_MIGRATE_NBS', 'outbound_migration', 'Pipeline to migrate CA-NBS files to Snowflake', 'CA_AG_DATASOURCE_NBS', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'outbound_migration', 'Pipeline to migrate CA-ClientODS files to Snowflake', 'CA_AG_DATASOURCE_CLIENTODS', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('CA_MIGRATE_NFS_RAA', 'outbound_migration', 'Pipeline to migrate CA-NFS files to Snowflake', 'CA_AG_DATASOURCE_NFS_RAA', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('ASSETS_COPY_ALBRIDGE', 'copy', 'Pipeline to copy Assets-Albridge files from remote location', 'ASSETS_AG_DATASOURCE_ALBRIDGE_COPY', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('ASSETS_MIGRATE_NFS_SPF', 'outbound_migration', 'Pipeline to migrate Assets-NFS files to Snowflake', 'ASSETS_AG_DATASOURCE_NFS_SPF', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP),

('COPY_NFS', 'copy', 'Pipeline to copy NFS files from remote location', 'AG_DATASOURCE_NFS_COPY', '', '0 13 * * *', '1', 'System', CURRENT_TIMESTAMP)

;







SELECT * FROM metadata.Pipeline
order by PipelineKey
;







CREATE TABLE metadata.PipelineConfiguration
(
PipelineConfigurationId int Identity,
PipelineKey varchar(1000),
ConfigKey nvarchar(1000),
ConfigValue nvarchar(4000),
UpdatedBy varchar(1000),
UpdateTS datetime
);






INSERT INTO metadata.PipelineConfiguration 
(PipelineKey, ConfigKey, ConfigValue, UpdatedBy, UpdateTS)
VALUES
('GENERIC', 'CREATE_DDL_FILES', 'TRUE', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'OUTPUT_LOG_PATH', '/usr/local/spark/resources/fileshare/Shared/logs', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'OUTPUT_DDL_PATH', '/usr/local/spark/resources/fileshare/Shared/DDL', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'TEMPORARY_FILE_PATH', '/usr/local/spark/resources/Shared/TEMP', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'APP_DATA_PATH', '/usr/local/spark/resources/fileshare/Shared/APPDATA', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'SNOWFLAKE_ACCOUNT', 'advisorgroup-edip', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'SNOWFLAKE_KEY_VAULT_ACCOUNT', 'snowflake', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'SNOWFLAKE_ROLE', 'AD_SNOWFLAKE_QA_DBA', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'SNOWFLAKE_WAREHOUSE', 'QA_RAW_WH', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'AZURE_STORAGE_ACCOUNTS_PREFIX', 'ag', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'AZURE_STORAGE_ACCOUNTS_DEFAULT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'AZURE_STORAGE_ACCOUNTS_SUFFIX', 'lakescd', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'AZURE_CONTAINER_NAME', 'ingress', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'AZURE_DATA_FOLDER', 'data', 'System', CURRENT_TIMESTAMP),
('GENERIC', 'AZURE_METADATA_FOLDER', 'metadata', 'System', CURRENT_TIMESTAMP),



('METRICS_MIGRATE_ASSETS_RAA', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/METRICS_ASSETS/RAA', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'DB_NAME', 'METRICS', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'SCHEMA_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'FILE_HISTORY_START_DATE', '2021-08-15', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'IS_FULL_LOAD', 'TRUE', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'DATE_FORMAT', '%Y%m%d', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_RAA', 'SQL_FILE_HISTORY_TABLE', 'metrics_assets_file_history3', 'System', CURRENT_TIMESTAMP),



('METRICS_MIGRATE_ASSETS_WFS', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/METRICS_ASSETS/WFS', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'DB_NAME', 'METRICS', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'SCHEMA_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'FILE_HISTORY_START_DATE', '2021-08-15', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'IS_FULL_LOAD', 'TRUE', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'DATE_FORMAT', '%Y%m%d', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_WFS', 'SQL_FILE_HISTORY_TABLE', 'metrics_assets_file_history3', 'System', CURRENT_TIMESTAMP),



('METRICS_MIGRATE_ASSETS_SPF', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/METRICS_ASSETS/SPF', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'DB_NAME', 'METRICS', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'SCHEMA_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'FILE_HISTORY_START_DATE', '2021-08-15', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'IS_FULL_LOAD', 'TRUE', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'DATE_FORMAT', '%Y%m%d', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('METRICS_MIGRATE_ASSETS_SPF', 'SQL_FILE_HISTORY_TABLE', 'metrics_assets_file_history3', 'System', CURRENT_TIMESTAMP),



('ASSETS_MIGRATE_FRONTPOINT', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/FRONTPOINT', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'DB_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'SCHEMA_NAME', 'FRONTPOINT', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'FILE_HISTORY_START_DATE', '2021-12-13', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'SCHEMA_FILE_PATH', '/usr/local/spark/resources/fileshare/EDIP-Code/config/assets/frontpoint_schema/frontpoint_schema.csv', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_FRONTPOINT', 'SQL_FILE_HISTORY_TABLE', 'assets_frontpoint_file_history3', 'System', CURRENT_TIMESTAMP),



('ASSETS_MIGRATE_PRODUCT', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/AG_ASSETS_PRODUCT', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'DB_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'SCHEMA_NAME', 'PRODUCT', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'FILE_HISTORY_START_DATE', '2022-01-01', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'IS_FULL_LOAD', 'TRUE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PRODUCT', 'SQL_FILE_HISTORY_TABLE', 'assets_product_file_history3', 'System', CURRENT_TIMESTAMP),



('CA_MIGRATE_PERSHING_RAA', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'COPY_ONLY_FILES', 'ACCT,ACCF', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/PERSHING-CA/RAA', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'DB_NAME', 'CLIENTACCOUNT', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'SCHEMA_NAME', 'PERSHING', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'AZURE_STORAGE_ACCOUNT_MID', 'raa', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'FILE_HISTORY_START_DATE', '2021-08-15', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'SCHEMA_FILE_PATH', '/usr/local/spark/resources/fileshare/EDIP-Code/config/pershing_schema', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'ADD_FIRM_TO_TABLE_NAME', 'TRUE', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'START_LINE_RECORD_POSITION', '3', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_PERSHING_RAA', 'START_LINE_RECORD_STRING', 'A', 'System', CURRENT_TIMESTAMP),



('ASSETS_MIGRATE_PERSHING_RAA', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'COPY_ONLY_FILES', 'GACT,GCUS,GMON', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/PERSHING-ASSETS/RAA', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'DB_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'SCHEMA_NAME', 'PERSHING', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'AZURE_STORAGE_ACCOUNT_MID', 'raa', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'FILE_HISTORY_START_DATE', '2021-08-15', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'SCHEMA_FILE_PATH', '/usr/local/spark/resources/fileshare/EDIP-Code/config/pershing_schema', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'ADD_FIRM_TO_TABLE_NAME', 'TRUE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'START_LINE_RECORD_POSITION', '3', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_PERSHING_RAA', 'START_LINE_RECORD_STRING', 'A', 'System', CURRENT_TIMESTAMP),



('ASSETS_MIGRATE_ALBRIDGE_WFS', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/ALBRIDGE/WFS', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'DB_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'SCHEMA_NAME', 'ALBRIDGE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'AZURE_STORAGE_ACCOUNT_MID', 'wfs', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'FILE_HISTORY_START_DATE', '2021-10-15', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'SCHEMA_FILE_PATH', '/usr/local/spark/resources/fileshare/EDIP-Code/config/assets/albridge_schema/albridge_schema.csv', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'FIN_INST_ID', '63', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'DATE_FORMAT', '%Y%m%d', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_ALBRIDGE_WFS', 'ADD_FIRM_TO_TABLE_NAME', 'TRUE', 'System', CURRENT_TIMESTAMP),



('ASSETS_COPY_ALBRIDGE', 'REMOTE_PATH', '/usr/local/spark/resources/fileshare/APP01/sftpsite/StatementOne/s1tov2020', 'System', CURRENT_TIMESTAMP),
('ASSETS_COPY_ALBRIDGE', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/ALBRIDGE', 'System', CURRENT_TIMESTAMP),
('ASSETS_COPY_ALBRIDGE', 'FILE_HISTORY_START_DATE', '2021-10-15', 'System', CURRENT_TIMESTAMP),
('ASSETS_COPY_ALBRIDGE', 'DATE_FORMAT', '%Y%m%d', 'System', CURRENT_TIMESTAMP),
('ASSETS_COPY_ALBRIDGE', 'FID_MAP', 'FSC:107,WFS:163,RAA:119,SAI:1134,SPF:130,TRI:1293', 'System', CURRENT_TIMESTAMP),



('CA_MIGRATE_NBS', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/NBS', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'DB_NAME', 'CLIENTACCOUNT', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'SCHEMA_NAME', 'NBS', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'FILE_HISTORY_START_DATE', '2022-01-01', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NBS', 'IS_FULL_LOAD', 'TRUE', 'System', CURRENT_TIMESTAMP),



('CA_MIGRATE_CLIENTODS', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/CLIENTODS', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'DB_NAME', 'CLIENTACCOUNT', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'SCHEMA_NAME', 'CLIENTODS', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'FILE_HISTORY_START_DATE', '2022-01-01', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_CLIENTODS', 'IS_FULL_LOAD', 'TRUE', 'System', CURRENT_TIMESTAMP),





('ASSETS_MIGRATE_DATASTORE_ALBRIDGE_RAA', 'ADD_FIRM_TO_TABLE_NAME', 'TRUE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_DATASTORE_ALBRIDGE_WFS', 'ADD_FIRM_TO_TABLE_NAME', 'TRUE', 'System', CURRENT_TIMESTAMP),




('CA_MIGRATE_NFS_RAA', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/NFS-CA', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'DB_NAME', 'CLIENTACCOUNT', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'SCHEMA_NAME', 'NFS', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'IS_FULL_LOAD', 'TRUE', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'SNOWFLAKE_ROLE', 'QA_CLIENTACCOUNT_DBO', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'SNOWFLAKE_WAREHOUSE', 'QA_CLIENTACCOUNT_RAW_WH', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'FILE_HISTORY_START_DATE', '2022-01-15', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'SCHEMA_FILE_PATH', '/usr/local/spark/resources/fileshare/EDIP-Code/config/nfs_schema', 'System', CURRENT_TIMESTAMP),
('CA_MIGRATE_NFS_RAA', 'CLIENTID_MAP', 'MAJ:RAA,FXA:SPF,FL2:FSC', 'System', CURRENT_TIMESTAMP),




('ASSETS_MIGRATE_NFS_SPF', 'SOURCE_PATH', '/usr/local/spark/resources/fileshare/Shared/NFS-ASSETS/SPF', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'DB_NAME', 'ASSETS', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'SCHEMA_NAME', 'NFS', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'AZURE_STORAGE_ACCOUNT_MID', 'aggr', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'IS_FULL_LOAD', 'FALSE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'SNOWFLAKE_ROLE', 'QA_ASSETS_DBO', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'SNOWFLAKE_WAREHOUSE', 'QA_ASSETS_RAW_WH', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'COPY_ONLY_FILES', '', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'DELETE_FILES_AFTER', 'FALSE', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'FILE_HISTORY_START_DATE', '2022-01-15', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'SCHEMA_FILE_PATH', '/usr/local/spark/resources/fileshare/EDIP-Code/config/nfs_schema', 'System', CURRENT_TIMESTAMP),
('ASSETS_MIGRATE_NFS_SPF', 'CLIENTID_MAP', 'MAJ:RAA,FXA:SPF,FL2:FSC', 'System', CURRENT_TIMESTAMP),




INSERT INTO metadata.PipelineConfiguration 
(PipelineKey, ConfigKey, ConfigValue, UpdatedBy, UpdateTS)
VALUES
('COPY_NFS', 'REMOTE_PATH', '', 'System', CURRENT_TIMESTAMP),
('COPY_NFS', 'SOURCE_PATH_NAME_AND_ADDRESS', '/usr/local/spark/resources/fileshare/Shared/NFS-CA', 'System', CURRENT_TIMESTAMP),
('COPY_NFS', 'SOURCE_PATH_POSITION', '/usr/local/spark/resources/fileshare/Shared/NFS-ASSETS', 'System', CURRENT_TIMESTAMP),
('COPY_NFS', 'SOURCE_PATH_ACTIVITY', '/usr/local/spark/resources/fileshare/Shared/NFS-ASSETS', 'System', CURRENT_TIMESTAMP),
('COPY_NFS', 'FILE_HISTORY_START_DATE', '2021-10-15', 'System', CURRENT_TIMESTAMP),
('COPY_NFS', 'CLIENTID_MAP', 'MAJ:RAA,FXA:SPF,FL2:FSC', 'System', CURRENT_TIMESTAMP)

;







select * from metadata.PipelineConfiguration
where PipelineKey = 'COPY_NFS'
;







SELECT TOP 1 p.*, ds.firm, ds.DataSourceType 
FROM metadata.Pipeline p
	LEFT JOIN metadata.DataSource ds ON p.DataSourceKey = ds.DataSourceKey
WHERE p.IsActive = 1
	and p.PipelineKey = 'METRICS_DATASTORE_MIGRATE_RAA'
ORDER BY p.UpdateTs DESC, p.PipelineId DESC
;



update metadata.PrimaryKey
set AssetSchema = 'NFS'
where id = 459
;



select * from metadata.PrimaryKey
order by Id desc;



insert into metadata.PrimaryKey
(	[RevisionSeq],
	[DataSource],
	[AssetSchema],
	[AssetName],
	[AssetUniqueKey],
	[SystemPrimaryKey],
	[BusinessKey],
	[CreateTS],
	[CreatedBy],
	[UpdateTS],
	[UpdatedBy],
	[DomainName],
	[DataSourceUniqueKey]

)
VALUES
(
1,
'NFS',
'NFS',
'POSITION',
'POSITION',
'Firm,AccountNumber,AccountType,CUSIP,SecurityType',
'',
CURRENT_TIMESTAMP,
'System',
CURRENT_TIMESTAMP,
'System',
'Assets',
'NFS'
)

;






SELECT * FROM metadata.PipelineInstance;




